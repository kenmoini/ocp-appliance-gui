---
- name: Copies a file from one host to another
  hosts: targetServer
  tasks:

    - name: SCP things around because the syncronize module sucks
      ansible.builtin.shell:
        cmd: "scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR {{ inventory_hostname['sourceServer']['ansible_host'] }}:{{ srcFilePath }} {{ targetFilePath }}"

    # - name: Transfer file from sourceServer to targetServer
    #   ansible.posix.synchronize:
    #     src: "{{ srcFilePath }}"
    #     dest: "{{ targetFilePath }}"
    #     compress: "{{ compressTransfer | default(false) }}"

    - name: Set the permissions of the freshly copied file
      when: targetModePermissions is defined or targetOwner is defined or targetGroup is defined
      ansible.builtin.file:
        mode: "{{ targetModePermissions | default(omit) }}"
        owner: "{{ targetOwner | default(omit) }}"
        group: "{{ targetGroup | default(omit) }}"
        path: "{{ targetFilePath }}"
      #delegate_to: targetServer
